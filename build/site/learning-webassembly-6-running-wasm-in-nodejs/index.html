<!doctype html>
<html lang="en">
<head>
    <title>Learning WebAssembly #6: Running Wasm in Node.js</title>
    <meta name="description" content="Running Wasm code in Node.js, the popular backend platform.">
    <meta name="author" content="Tomas Tulka">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@tomas_tulka">
    <meta name="twitter:creator" content="@tomas_tulka">
    <meta name="twitter:title" content="Learning WebAssembly #6: Running Wasm in Node.js by Tomas Tulka">
    <meta name="twitter:image:src" content="https://blog.ttulka.com/assets/img/blog.jpg">
    <meta property="og:url" content="https://blog.ttulka.com/learning-webassembly-6-running-wasm-in-nodejs" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Learning WebAssembly #6: Running Wasm in Node.js by Tomas Tulka" />
    <meta property="og:image" content="https://blog.ttulka.com/assets/img/blog.jpg">

    <link href="/assets/css/syntaxhighlighter.css" rel="stylesheet">
    <link href="/assets/css/blog.2.7.css" rel="stylesheet">
</head>
<body>

<header class="header">
    <div class="container">
        <nav class="nav">
            <a class="active" href="/">Home</a>
            <a href="/about">About</a>
        </nav>
        <div class="ext-links">
            <a href="https://twitter.com/tomas_tulka"><img src="/assets/img/twitter.png"></a>
            <a href="https://github.com/ttulka"><img src="/assets/img/github.png"></a>
            <a href="#" class="theme"><img src="/assets/img/theme.png"></a>
        </div>
    </div>
</header>

<main class="main">

    <article class="blog-post">
    <h1 class="blog-post__title">Learning WebAssembly #6: Running Wasm in Node.js</h1>
    <p class="blog-post__meta">2021-01-06 by Tomas Tulka</p>
    <p>Running Wasm code in Node.js, the popular backend platform.</p>
    <hr>
    <p>In the <a href="/learning-webassembly-5-running-wasm-in-the-browser" target="_blank">previous part</a> of this <a href="/learning-webassembly-series" target="_blank">series</a>, we executed Wasm modules in a browser. In this part, we will achieve the same in <a href="https://nodejs.org" target="_blank">Node.js</a>, a popular JavaScript backend platform.</p>

<p>Starting with version 12, Node.js provides an implementation of the <a href="https://nodejs.org/api/wasi.html" target="_blank">WASI API</a>, WebAssembly System Interface. WASI gives sandboxed WebAssembly applications access to the underlying operating system features. In the following text, we will focus only on basic Wasm, WASI will be discussed in a dedicated future post.</p>

<h2>Wasm Module Initializing</h2>

<p>Practically, Node.js provides a global WebAssembly object, which we already know from <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Using_the_JavaScript_API" target="_blank">WebAssembly JavaScript API</a>.</p>

<p>There are some little differences though. For example, the convenience static method <code>instantiateStreaming</code> is missing whatsoever. The reason is quite clear: the method accepts an interface from the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank">Fetch API</a>, which is not provided by Node.js out of the box.</p>

<p>Instead, we can use the <code>instantiate</code> method which accepts an <code>ArrayBuffer</code>:</p>

<pre class="brush: javascript">
var buf = fs.readFileSync('./hello.wasm');
WebAssembly.instantiate(buf)...
</pre>

<p>The rest is the same as when <a href="/learning-webassembly-5-running-wasm-in-the-browser" target="_blank">running in a browser</a>:</p>

<pre class="brush: javascript">
WebAssembly
  .instantiate(fs.readFileSync('./hello.wasm'))
  .then(obj => console.log(obj.instance.exports.hello()));
</pre>

<p>It works on my machine:</p>

<pre>
$ node --version
v14.15.3

$ node hello.js
42
</pre>

<p>Similar for dealing with the memory or global variables. There is no change needed in the actual code except the initialization of a Wasm instance.</p>

<h2>Further Steps</h2>

<p>We have seen how easy is to work with WebAssembly in Node.js. Except for a little difference in the initialization, all that we have learned so far applies here as well. It’s very good news!</p>

<p>In the <a href="/learning-webassembly-7-introducing-wasi">next part</a> of this <a href="/learning-webassembly-series">series</a>, we will see how to access operating system features from Wasm with WebAssembly System Interface (WASI).</p>

<p>Stay tuned!</p>

</article>

<aside class="blog-tags">
    
    <a href="/tag/WebAssembly" class="tag">WebAssembly</a>
    
    <a href="/tag/Programming" class="tag">Programming</a>
    
    
</aside>

<aside class="blog-comments">
    <h2>Leave a message</h2>
    <p class="leave-message">You can add a comment to this post by <a href="https://github.com/ttulka/blog-content/edit/main/site/comments/learning-webassembly-6-running-wasm-in-nodejs.json">opening a pull request</a> (see <a href="https://github.com/ttulka/blog-content#add-a-new-comment">HowTo</a>).</p>

    
    
    
</aside>

</main>

<footer class="footer">
    <div class="container">
        <div class="footer__extended">© 2021 Tomas Tulka (ttulka)</div>
        <div class="footer__menu">
            <a href="/">Home</a> |
            <a href="/privacypolicy/">Privacy Policy</a>
        </div>
    </div>
</footer>

<script src="/assets/js/darktheme.js"></script>
<script src="/assets/js/syntaxhighlighter.min.js" defer></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZKWY8T55EM"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZKWY8T55EM');
</script>

</body>
</html>