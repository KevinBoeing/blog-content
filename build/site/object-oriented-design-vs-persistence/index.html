<!doctype html>
<html lang="en">
<head>
    <title>Object-Oriented Design vs. Persistence</title>
    <meta name="description" content="From time to time I attend discussions about OOP. Every time someone comes up with the argument of dealing with persistence. The typical question can be reduced to “should an object persist itself or rather be persisted?” I believe the question is fundamentally wrong.">
    <meta name="author" content="Tomas Tulka">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@tomas_tulka">
    <meta name="twitter:creator" content="@tomas_tulka">
    <meta name="twitter:title" content="Object-Oriented Design vs. Persistence by Tomas Tulka">
    <meta name="twitter:image:src" content="https://blog.ttulka.com/assets/img/blog.jpg">
    <meta property="og:url" content="https://blog.ttulka.com/object-oriented-design-vs-persistence" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Object-Oriented Design vs. Persistence by Tomas Tulka" />
    <meta property="og:image" content="https://blog.ttulka.com/assets/img/blog.jpg">

    <link href="/assets/css/syntaxhighlighter.css" rel="stylesheet">
    <link href="/assets/css/blog.2.7.css" rel="stylesheet">
</head>
<body>

<header class="header">
    <div class="container">
        <nav class="nav">
            <a class="active" href="/">Home</a>
            <a href="/about">About</a>
        </nav>
        <div class="ext-links">
            <a href="https://twitter.com/tomas_tulka"><img src="/assets/img/twitter.png"></a>
            <a href="https://github.com/ttulka"><img src="/assets/img/github.png"></a>
            <a href="#" class="theme"><img src="/assets/img/theme.png"></a>
        </div>
    </div>
</header>

<main class="main">

    <article class="blog-post">
    <h1 class="blog-post__title">Object-Oriented Design vs. Persistence</h1>
    <p class="blog-post__meta">2020-01-19 by Tomas Tulka</p>
    <p>From time to time I attend discussions about OOP. Every time someone comes up with the argument of dealing with persistence. The typical question can be reduced to “should an object persist itself or rather be persisted?” I believe the question is fundamentally wrong.</p>
    <hr>
    <h2>Traditional Approach</h2>

<p>Traditionally (and very wrongly) an object is seen as data with a bunch of procedures dealing upon it. A typical school-book code looks like follows:</p>
<pre class="brush: java">
class Person {

  private String personalId;
  private String firstName;
  private String lastName;

  String getPersonalId() { return personalId; }
  String getFirstName() { return firstName; }
  String getLastName() { return lastName; }
}
</pre>

<p>How to persist the Person object? One approach is to create a repository:</p>
<pre class="brush: java">
class PersonRepository {

  void save(Person person) {
    // persist the object
  }
}
</pre>

<p>Second approach is to let the object persist itself:</p>

<pre class="brush: java">
class Person {
  // ...

  void save() {
    // persist the object
  }
}
</pre>

<p>Which one is better? None, or more precisely, depends.</p>

<h2>Domain-Driven Design</h2>

<p><a href="https://en.wikipedia.org/wiki/Domain-driven_design" target="_blank">Domain-Driven Design (DDD)</a> calls for designing objects driven by their business (domain) meaning rather than by technical aspects. According DDD, <strong>persistence is just an implementation detail</strong>. How this helps us with our dilemma? Actually a lot: the question, where to put the persistence, is driven by the domain as well as all other concerns.</p>

<p>Just listen to the business, what does it say? Is it talking about
 <em>a register</em> for people registration?</p>
<pre class="brush: java">
class PersonRegister {

  void register(Person person) {
    // ...
  }
}
</pre>

<p>Or rather about person <em>reporting</em>, <em>checking in</em>, <em>applying</em> or <em>enrolling</em>?</p>
<pre class="brush: java">
class Person {
  // ...

  void enroll() {
    // ...
  }
}
</pre>

<p>Don’t think like a technician: "this object must be persisted", understand the domain and model around it. <strong>The domain must be found again in the model</strong>.</p>

<p>Because the theory can never know your domain, it’s impossible to create a framework helping to cut the code vertically. All the tool can only help with the horizontal cutting and technical regards, which encourages the implementers to concentrate too much on techniques (like persistence) and forget about the domain. The biggest problem with <a href="https://www.oreilly.com/library/view/domain-driven-design-tackling/0321125215/" target="_blank">the blue book</a> I have is that it focuses a lot on tactical design and building blocks like Entities, Services and Repositories. At the end of the day that is the only thing some readers get from the text ignoring the real value: the importance of <strong>communication with domain experts and understanding the business</strong> being built.</p>

<h2>Conclusion</h2>

<p>Pure technical concerns like persistence don’t belong to object-oriented design. These are mere implementation details hidden behind APIs. APIs tell the story of the domain. <strong>Model the API around the domain, don’t let implementation leak to the API</strong>.</p>

<p>Happy designing!</p>

</article>

<aside class="blog-tags">
    
    <a href="/tag/OOP" class="tag">OOP</a>
    
    <a href="/tag/DDD" class="tag">DDD</a>
    
    <a href="/tag/Design Patterns" class="tag">Design Patterns</a>
    
    <a href="/tag/Programming" class="tag">Programming</a>
    
    
</aside>

<aside class="blog-comments">
    <h2>Leave a message</h2>
    <p class="leave-message">You can add a comment to this post by <a href="https://github.com/ttulka/blog-content/edit/main/site/comments/object-oriented-design-vs-persistence.json">opening a pull request</a> (see <a href="https://github.com/ttulka/blog-content#add-a-new-comment">HowTo</a>).</p>

    
    
    
</aside>

</main>

<footer class="footer">
    <div class="container">
        <div class="footer__extended">© 2021 Tomas Tulka (ttulka)</div>
        <div class="footer__menu">
            <a href="/">Home</a> |
            <a href="/privacypolicy/">Privacy Policy</a>
        </div>
    </div>
</footer>

<script src="/assets/js/darktheme.js"></script>
<script src="/assets/js/syntaxhighlighter.min.js" defer></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZKWY8T55EM"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZKWY8T55EM');
</script>

</body>
</html>