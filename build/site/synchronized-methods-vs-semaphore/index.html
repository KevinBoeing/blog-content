<!doctype html>
<html lang="en">
<head>
    <title>Synchronized Methods vs. Semaphore</title>
    <meta name="description" content="When one-thread-access for synchronized methods is too restrictive, semaphores come to mind.">
    <meta name="author" content="Tomas Tulka">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@tomas_tulka">
    <meta name="twitter:creator" content="@tomas_tulka">
    <meta name="twitter:title" content="Synchronized Methods vs. Semaphore by Tomas Tulka">
    <meta name="twitter:image:src" content="https://blog.ttulka.com/assets/img/blog.jpg">
    <meta property="og:url" content="https://blog.ttulka.com/synchronized-methods-vs-semaphore" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Synchronized Methods vs. Semaphore by Tomas Tulka" />
    <meta property="og:image" content="https://blog.ttulka.com/assets/img/blog.jpg">

    <link href="/assets/css/syntaxhighlighter.css" rel="stylesheet">
    <link href="/assets/css/blog.2.7.css" rel="stylesheet">
</head>
<body>

<header class="header">
    <div class="container">
        <nav class="nav">
            <a class="active" href="/">Home</a>
            <a href="/about">About</a>
        </nav>
        <div class="ext-links">
            <a href="https://twitter.com/tomas_tulka"><img src="/assets/img/twitter.png"></a>
            <a href="https://github.com/ttulka"><img src="/assets/img/github.png"></a>
            <a href="#" class="theme"><img src="/assets/img/theme.png"></a>
        </div>
    </div>
</header>

<main class="main">

    <article class="blog-post">
    <h1 class="blog-post__title">Synchronized Methods vs. Semaphore</h1>
    <p class="blog-post__meta">2017-08-02 by Tomas Tulka</p>
    <p>When one-thread-access for synchronized methods is too restrictive, semaphores come to mind.</p>
    <hr>
    <p>There is one important difference in these approaches.</p>

<p>Let's consider a code:</p>
<pre class="brush: java">private Object synch = new Object();

public void synchronizedMethod1() {
    synchronized (synch) {
        synchronizedMethod2();
    }
}

public void synchronizedMethod2() {
    synchronized (synch) {
        System.out.println("Access to the resource acquired.");
    }
}</pre>
<p>What happened by calling the <code>synchronizedMethod1()</code>?</p>
<p>Of course the access to the resource will be acquired because the synchronized block is in Java shared in within the thread. In other words, if the thread is already in the synchronized block will get all the others as well (protected by the same object).</p>

<p>Applying a semaphore (with the counter set to one) on the same code:</p>
<pre class="brush: java">private Semaphore semaphore = new Semaphore(1);

public void synchronizedMethod1() throws InterruptedException {
    semaphore.acquire();
    synchronizedMethod2();
    semaphore.release();
}

public void synchronizedMethod2() throws InterruptedException {
    semaphore.acquire();
    System.out.println("Access to the resource acquired.");
    semaphore.release();
} </pre>
<p>And calling <code>synchronizedMethod1()</code> will freeze forever.</p>

<p>In this case acquire the <code>synchronizedMethod1</code> the semaphore but <code>synchronizedMethod2</code>&nbsp;fails on trying to acquire it again.</p>

<p>In general, this problem is caused by a weak design and can be solved by a simple refactoring:</p>
<pre class="brush: java">public void synchronizedMethod1() throws InterruptedException {
    semaphore.acquire();
    resourceMethod();
    semaphore.release();
}

public void synchronizedMethod2() throws InterruptedException {
    semaphore.acquire();
    resourceMethod();
    semaphore.release();
}

private void resourceMethod() {
    System.out.println("Access to the resource acquired.");
}</pre>

</article>

<aside class="blog-tags">
    
    <a href="/tag/Programming" class="tag">Programming</a>
    
    <a href="/tag/Java" class="tag">Java</a>
    
    
</aside>

<aside class="blog-comments">
    <h2>Leave a message</h2>
    <p class="leave-message">You can add a comment to this post by <a href="https://github.com/ttulka/blog-content/edit/main/site/comments/synchronized-methods-vs-semaphore.json">opening a pull request</a> (see <a href="https://github.com/ttulka/blog-content#add-a-new-comment">HowTo</a>).</p>

    
    
    
</aside>

</main>

<footer class="footer">
    <div class="container">
        <div class="footer__extended">Â© 2021 Tomas Tulka (ttulka)</div>
        <div class="footer__menu">
            <a href="/">Home</a> |
            <a href="/privacypolicy/">Privacy Policy</a>
        </div>
    </div>
</footer>

<script src="/assets/js/darktheme.js"></script>
<script src="/assets/js/syntaxhighlighter.min.js" defer></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZKWY8T55EM"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZKWY8T55EM');
</script>

</body>
</html>